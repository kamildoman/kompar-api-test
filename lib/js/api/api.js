var au="kr",mu="mån",kr20="20 000 kr",kr7="7 000 000 kr",k_20=2e4,b_7=7e6,companies=[],wc=-1,pnvalid=!1,bnvalid=!1,agr=!1;function finishForm(){if(pnvalid&&bnvalid&&agr){var e=docId("messageBankId"),n=docId("frameForBankId");e.style.visibility="visible",n.style.visibility="hidden",fetch("https://kompar-se.herokuapp.com/core/token",{method:"GET"}).then(e=>e.json()).then(t=>{var a=t.config,r=t.token;coreid_client.init({config:a,token:r,callback:function(t){e.style.visibility="hidden",n.style.visibility="visible",t.success&&t.token&&fetch("https://kompar-se.herokuapp.com/core/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t.token})}).then(e=>e.json()).then(e=>{coreid_client.close(),window.dataLayer.push({event:"correct-bank-id"});var n="",t="";if(0==companies.length||wc==companies.length-1)n=docId("manualId").value.replace(/[^0-9.]/g,""),t=docId("manualName").value;else{var a=companies[wc];n=a.companyId,t=a.companyName}var r=new URL(window.location.href),i=r.searchParams.get("at_gd"),o=r.searchParams.get("coid"),d=`https://app.kompar.se/index_test?amount=${eURI(docId("amount_id").value.replace(/[^0-9.]/g,""))}&refinancing=${eURI(docId("ref_id").value.replace(/[^0-9.]/g,""))}&duration=${eURI(docId("months_id").value.replace(/[^0-9.]/g,""))}&use=${eURI("Omfinansiering av lån / samla lån")}&phone=${eURI(docId("phone_id").value)}&email=${eURI(docId("email_id").value)}&name=${eURI(e.name)}&personal_id=${eURI(e.personal_id)}&company_id=${eURI(n)}&company_name=${eURI(t)}`;null!=i&&(d+=`&at_gd=${i}`),null!=o&&(d+=`&adservice=${o}`),_tfa||_tfa.push({notify:"event",name:"complete_registration",id:1267183}),window.location.href=d})}}),coreid_client.start()})}else if(pnvalid)bnvalid?agr||showagrError():showBusinessIdError();else{var t=docCR("div");t.style.width="49%";var a=docCR("label");a.setAttribute("class","invalid"),a.innerHTML="Fyll i ett korrekt personnummer",t.appendChild(a),docId("companies").innerHTML="",docId("companies").appendChild(t)}}function amount_on_input(e){docId("amount_id").value=e.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ")}function amount_range_on_input(e){var n=parseInt(e,10),t=docId("ref_range_id");n<parseInt(t.value,10)&&(t.value=e,docId("ref_id").value=correct_amount(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+` ${au}`),docId("amount_id").value=correct_amount(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+` ${au}`}function ref_range_on_input(e){var n=parseInt(e,10),t=docId("amount_range_id");n>parseInt(t.value,10)&&(t.value=e,docId("amount_id").value=correct_amount(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+` ${au}`),docId("ref_id").value=correct_amount(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")+` ${au}`}function correct_amount(e){return e>=1&&e<=7?5e3*(e+3):e>=8&&e<=12?1e4*(e-2):e>=13&&e<=17?2e4*(e-7):e>=18&&e<=22?5e4*(e-13):e>=23&&e<=28?1e5*(e-18):e>=29&&e<=32?25e4*(e-24):e>=33&&e<=42?5e5*(e-28):void 0}function months_range_on_input(e){var n=parseInt(e,10);n>=1&&n<=18?docId("months_id").value=e+` ${mu}`:n>=18&&n<60&&(docId("months_id").value=correct_months(n).toString()+` ${mu}`)}function correct_months(e){return 6*e-90}function ref_on_input(e){docId("ref_id").value=e.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ")}document.getElementById("myForm").addEventListener("submit",function(e){e.preventDefault()});var hbrc=!1;function ref_on_click(e){if(!hbrc){hbrc=!0;var n=docId("ref_id"),t=n.value.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ");n.value=t}}var wmir=!1;function ref_on_mouse_move(e){if(!wmir){wmir=!0;var n=docId("ref_id"),t=n.value.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ");n.value=t}}function ref_on_mouse_out(){wmir=!1,hbrc=!1;var e=docId("ref_id"),n=e.value.replace(/[^0-9.]/g,""),t=parseInt(n,10);if(t<k_20)e.value=kr20;else if(t>b_7)e.value=kr7;else{var a=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ");e.value=a+" kr"}}var hbac=!1;function amount_on_click(e){if(!hbac){hbac=!0;var n=docId("amount_id"),t=n.value.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ");n.value=t}}var wmia=!1;function amount_on_mouse_move(e){if(!wmia){wmia=!0;var n=docId("amount_id"),t=n.value.replace(/[^0-9.]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g," ");n.value=t}}function amount_on_mouse_out(){wmia=!1,hbac=!1;var e=docId("amount_id"),n=e.value.replace(/[^0-9.]/g,""),t=parseInt(n,10);if(t<k_20)e.value=kr20;else if(t>b_7)e.value=kr7;else{var a=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ");e.value=a+" kr"}}var wmim=!1;function months_on_mouse_move(){if(!wmim){wmim=!0;var e=docId("months_id"),n=e.value.replace(/[^0-9.]/g,"");e.value=n}}function months_on_mouse_out(){wmim=!1;var e=docId("months_id"),n=e.value.replace(/[^0-9.]/g,""),t=parseInt(n,10);e.value=t<1?`1 ${mu}`:t>60?`60 ${mu}`:t+` ${mu}`}function amount_slider(e){return e>=2e4&&e<=5e4?mf((parseInt(e,10)-15e3)/5e3):e>5e4&&e<=1e5?mf((parseInt(e,10)+2e4)/1e4):e>1e5&&e<=2e5?mf((parseInt(e,10)+14e4)/2e4):e>2e5&&e<=5e5?mf((parseInt(e,10)+65e4)/5e4):e>5e5&&e<=1e6?mf((parseInt(e,10)+18e5)/1e5):e>1e6&&e<=2e6?mf((parseInt(e,10)+6e6)/25e4):e>2e6&&e<=7e6?mf((parseInt(e,10)+14e6)/5e5):void 0}var OA=docId("amount_id").value.replace(/[^0-9.]/g,""),OR=docId("ref_id").value.replace(/[^0-9.]/g,"");function myFormOnClick(){var e=docId("amount_id").value.replace(/[^0-9.]/g,"");docId("amount_range_id").value=amount_slider(e).toString();var n=docId("ref_id").value.replace(/[^0-9.]/g,"");docId("ref_range_id").value=amount_slider(n).toString();var t=docId("amount_id"),a=docId("ref_id");OA!=e?e<n&&(a.value=t.value,docId("ref_range_id").value=amount_slider(e).toString()):OR!=n&&n>e&&(t.value=a.value,docId("amount_range_id").value=amount_slider(n).toString());var r=docId("months_id").value.replace(/[^0-9.]/g,"");docId("months_range_id").value=months_slider(r).toString(),OA=e,OR=n}function months_slider(e){return e<19?e:mf((parseInt(e,10)+90)/6)}function mf(e){return Math.floor(e)}var x,i,j,se,a,b,c,ar=!1;function newPersonalId(e){if(docId("companies").innerHTML="",docId("input").innerHTML="",docId("input_error").innerHTML="",!ar&&e.length>=10&&e.length<=12)if(validate(e)){pnvalid=!0;var n=docCR("div");n.style.width="49%";var t=docCR("div");t.setAttribute("class","loader"),n.appendChild(t),docId("companies").appendChild(n),ar=!0;fetch("https://kompar-se.herokuapp.com/roaring/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(e=>e.json()).then(e=>{if(docId("companies").innerHTML="",ar=!1,companies=e.companies,e.correct)if(0==companies.length&&e.correct)showManual();else{companies.push({companyName:"Fyll i manuellt"});var n=docCR("div");n.style.display="table",n.style.width="100%";var t=docCR("label");t.setAttribute("class","chooseCompany"),t.innerHTML="Välj företag",n.appendChild(t),wc=0,bnvalid=!0;for(let e=0;e<companies.length;e++){var a=docCR("div");a.setAttribute("class","companyRow");var r=companies[e].companyName,i=docCR("input");i.setAttribute("type","radio"),i.setAttribute("name","banks"),i.setAttribute("class","companyRadio"),i.setAttribute("id",`i:${e}`),e==companies.length-1?i.addEventListener("change",function(){bnvalid=!1,wc=companies.length-1,showManual()}):i.addEventListener("change",function(){bnvalid=!0,wc=e,docId("input").innerHTML=""}),0==e&&(i.checked=!0);var o=docCR("label");o.setAttribute("for",`i:${e}`),o.appendChild(document.createTextNode(r)),o.setAttribute("class","companyLabel"),a.appendChild(i),a.appendChild(o),n.appendChild(a)}docId("companies").appendChild(n)}else showPersonError()}).catch(e=>{ar=!1})}else showPersonError();else ar=!1,docId("companies").innerHTML=""}function validate(e){var n=new RegExp(/^(\d{2}){0,1}(\d{2})(\d{2})(\d{2})([\-|\+]{0,1})?(\d{3})(\d{0,1})$/).exec(e);if(!n)return!1;var t=n[2],a=n[3],r=n[4],i=(n[6],n[7]);return!(!checkDate(+t,+a,+r)||luhn(t+a+r+i)!==+i&&!i)||!(!checkDate(+t,+a,+r-60)||luhn(t+a+r+i)!==+i&&!i)}function luhn(e){for(var n=0,t=0,a=0;a<e.length;a++)t=e[a],(t*=2-a%2)>9&&(t-=9),n+=t;return 10*Math.ceil(n/10)-n}function checkDate(e,n,t){n-=1;var a=new Date(e,n,t);return!(a.getYear()!==e||a.getMonth()!==n||a.getDate()!==t)}function showPersonError(){pnvalid=!1,ar=!1;var e=docCR("div");e.style.width="49%";var n=docCR("label");n.setAttribute("class","invalid"),n.innerHTML="Fyll i ett korrekt personnummer",e.appendChild(n),docId("companies").innerHTML="",docId("companies").appendChild(e)}function showManual(){var e=docCR("div");e.setAttribute("class","row");var n=docCR("input");n.setAttribute("class","left"),n.placeholder="Organisationsnummer",n.setAttribute("form","myForm"),n.setAttribute("id","manualId"),n.setAttribute("minlength","10"),n.setAttribute("maxlength","11"),n.addEventListener("input",function(e){var n=e.target.value;n.length>=10&&n.length<=11?10==n.length?(docId("input_error").innerHTML="",bnvalid=!0):11==n.length&&"-"==n[6]?(docId("input_error").innerHTML="",bnvalid=!0):(bnvalid=!1,showBusinessIdError()):(docId("input_error").innerHTML="",bnvalid=!1)}),n.required=!0;var t=docCR("input");t.setAttribute("class","right"),t.placeholder="Företag",t.setAttribute("form","myForm"),t.setAttribute("id","manualName"),t.required=!0,e.appendChild(n),e.appendChild(t),docId("input").appendChild(e)}function showBusinessIdError(){var e=docCR("div");e.style.width="90%";var n=docCR("label");n.setAttribute("class","invalid2"),n.innerHTML="Fyll i ett korrekt organisationsnummer",e.appendChild(n),docId("input_error").innerHTML="",docId("input_error").appendChild(e)}function checkagr(){var e=docId("firstagrId");1==e.checked&&(docId("error_agr").innerHTML=""),agr=e.checked}function showagrError(){var e=docCR("div");e.style.width="90%",e.style.marginLeft="30px",e.style.padding="10px",e.style.paddingTop="5px";var n=docCR("label");n.setAttribute("class","invalid1"),n.innerHTML="Godkänn villkoren för att fortsätta.",e.appendChild(n),docId("error_agr").innerHTML="",docId("error_agr").appendChild(e)}function eURI(e){return encodeURIComponent(e)}function docId(e){return document.getElementById(e)}function docCR(e){return document.createElement(e)}function docBCN(e){return document.getElementsByClassName(e)}for(x=docBCN("rightSelect"),i=0;i<x.length;i++){for(se=x[i].getElementsByTagName("select")[0],(a=docCR("div")).setAttribute("class","select-selected"),a.innerHTML=se.options[se.selectedIndex].innerHTML,x[i].appendChild(a),(b=docCR("div")).setAttribute("class","select-items select-hide"),j=1;j<se.length;j++)(c=docCR("div")).innerHTML=se.options[j].innerHTML,c.addEventListener("click",function(e){var n,t,a,r,i;for(docId("fakeInput").value="any",r=this.parentNode.parentNode.getElementsByTagName("select")[0],i=this.parentNode.previousSibling,t=0;t<r.length;t++)if(r.options[t].innerHTML==this.innerHTML){for(r.selectedIndex=t,i.innerHTML=this.innerHTML,n=this.parentNode.getElementsByClassName("same-as-selected"),a=0;a<n.length;a++)n[a].removeAttribute("class");this.setAttribute("class","same-as-selected");break}i.click()}),b.appendChild(c);x[i].appendChild(b),a.addEventListener("click",function(e){e.stopPropagation(),closeAllSelect(this),this.nextSibling.classList.toggle("select-hide"),this.classList.toggle("select-arrow-active")})}function closeAllSelect(e){var n,t,a,r=[];for(n=docBCN("select-items"),t=docBCN("select-selected"),a=0;a<t.length;a++)e==t[a]?r.push(a):t[a].classList.remove("select-arrow-active");for(a=0;a<n.length;a++)r.indexOf(a)&&n[a].classList.add("select-hide")}$("#fakeInput").keypress(function(e){e.preventDefault()}),$("#fakeInput").click(function(e){e.preventDefault()}),document.addEventListener("click",closeAllSelect);